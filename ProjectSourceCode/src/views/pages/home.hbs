{{>message}}
<title>Buff's Bulletin</title>
<main role="main" class="d-flex flex-column vh-100">
  <!-- Page Heading (fixed height) -->
  <div class="mb-1 text-center">
    <h1 class="display-6">Welcome to Buff's Bulletin!</h1>
    <p class="lead text-muted small">See what's happening around campus</p>
  </div>
  
  <!-- Layout: Sidebar + Map (fills remaining height) -->
  <div class="d-flex flex-grow-1 overflow-hidden">
    <!-- Sidebar -->
      <div id="sidebar" class="bg-light border-end d-flex flex-column gap-2 p-2">
        {{> new_event}}
        
        <!-- Fixed top content -->
        <div class="d-flex align-items-center justify-content-between gap-2">
          <button class="btn btn-sm btn-outline-secondary" id="expandSidebarBtn">Expand</button>
          <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#event_modal">
            Create Event
          </button>
        </div>

        <h2 class="events-title">Events</h2>
    
        <!-- Scrollable Event List container -->
        <div class="sidebar-scroll-container"></div>
      </div>

    <!-- Map -->
    <div id="map-container" class="flex-grow-1 position-relative" style="height: 100%;">
      {{> map }}
    </div>
  </div>
</main>

<script id="sidebar-template" type="text/x-handlebars-template">
  <ul class="list-group">
    \{{#each fetchedEvents}}
    <li class="list-group-item event-item sidebar-item" id="sidebar-item-\{{eventid}}" data-eventid="\{{eventid}}"
      onclick="submitFromElement(this)" onkeydown="if(event.key === 'Enter') submitFromElement(this)" role="button"
      tabindex="0">
      <div class="w-100">
        <strong class="fs-5">{{eventname}}</strong><br />
        <p class="mb-0"><strong>Location:</strong>
          \{{building}}
          Room
          \{{roomnumber}}</p>
        <p class="mb-0"><strong>Hosted by:</strong> \{{clubsponser}}</p>
  
        <!-- Individual form per event -->
        <form id="eventForm-\{{eventid}}" action="/event-details" method="GET" target="_blank" style="display: none;">
          <input type="hidden" name="eventID" value="{{eventid}}" />
        </form>
  
        <div class="sidebar-extra mt-2">
          <small class="text-muted">\{{eventdescription}}</small>
          <form action="/rsvp" method="POST">
            <input type="hidden" name="eventid" value=\{{eventid}} />
            <button type="submit">RSVP</button>
          </form>
        </div>
  
        <small class="text-muted">
          \{{eventDateFormatted}}
          â€”
          <span class="d-inline-block">\{{startTimeFormatted}}
            to
            \{{endTimeFormatted}}</span>
        </small>
  
      </div>
    </li>
    \{{/each}}
  </ul>
</script>
  
  <!-- script to bring user to an individual event's page on click -->
  <script>
    function submitFromElement(el) {
      const eventId = el.dataset.eventid; const
        form = document.getElementById(`eventForm-${eventId}`); if (form) {
          form.submit();
        }
    }
  </script>

<script type="text/javascript">
  var sidebarRender = document.querySelector('#sidebar-template');
  var sidebarContentContainer = document.querySelector('.sidebar-scroll-container');

  setTimeout(function () {
    var getEventsUrl = new Url('/get-events',. {
      params: {
        startTime: '10:00'
      }
    });

    fetch(getEventsUrl.url)
      .then(function (result) {
        return result.json()
      })
      .then(function (data) {
        console.log(data, Handlebars)
        var htmlString = Handlebars.compile(sidebarRender.innerHTML)({ fetchedEvents: data });
        console.log(htmlString)
        sidebarContentContainer.insertAdjacentHTML('beforeend', htmlString);
      })
  }, 500);
</script>
